{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Product Management</h2>
    
    <!-- Form Tambah Product -->
    <div class="form-section">
        <h3>Tambah Product Baru</h3>
        <form id="productForm">
            <select id="category_id" required>
                <option value="">Pilih Kategori</option>
                <!-- Options akan diisi oleh JavaScript -->
            </select>
            <input type="text" id="name" placeholder="Nama Product" required>
            <input type="number" id="price" placeholder="Harga" step="0.01" required>
            <input type="number" id="stock" placeholder="Stok" required>
            <button type="submit">Tambah Product</button>
        </form>
    </div>

    <!-- Tabel Product -->
    <div class="table-section">
        <h3>Daftar Products</h3>
        <table id="productTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Kategori</th>
                    <th>Harga</th>
                    <th>Stok</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan diisi oleh JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<script>
    // Memuat kategori untuk dropdown
    async function loadCategories() {
        try {
            const response = await fetch('/api/products/categories');
            const categories = await response.json();
            const select = document.getElementById('category_id');
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.CategoryID;
                option.textContent = category.Name;
                select.appendChild(option);
            });
        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    // Memuat data products
    async function loadProducts() {
        try {
            const response = await fetch('/api/products');
            const products = await response.json();
            
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.ProductID}</td>
                    <td>${product.Name}</td>
                    <td>${product.CategoryName}</td>
                    <td>${product.Price}</td>
                    <td>${product.Stock}</td>
                    <td>
                        <button onclick="editProduct(${product.ProductID})">Edit</button>
                        <button onclick="deleteProduct(${product.ProductID})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        } catch (error) {
            console.error('Error loading products:', error);
        }
    }

    // Menambah product
    document.getElementById('productForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
            category_id: parseInt(document.getElementById('category_id').value),
            name: document.getElementById('name').value,
            price: parseFloat(document.getElementById('price').value),
            stock: parseInt(document.getElementById('stock').value)
        };
        
        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            if (response.ok) {
                alert('Product berhasil ditambahkan!');
                document.getElementById('productForm').reset();
                loadProducts(); // Refresh data
            }
        } catch (error) {
            console.error('Error adding product:', error);
        }
    });

    // Fungsi delete product
    async function deleteProduct(productId) {
        if (confirm('Apakah Anda yakin ingin menghapus product ini?')) {
            try {
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Product berhasil dihapus!');
                    loadProducts(); // Refresh data
                }
            } catch (error) {
                console.error('Error deleting product:', error);
            }
        }
    }

    // Load data saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
        if (document.getElementById('productTable')) {
            loadCategories();
            loadProducts();
        }
    });
</script>
{% endblock %}